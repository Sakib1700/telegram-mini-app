<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Funny Tasks Telegram Mini App</title>
  <style>
    body {
      font-family: sans-serif;
      background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      flex-direction: column;
      color: #333;
    }
    .card {
      background: #fff;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      text-align: center;
      width: 90%;
      max-width: 400px;
    }
    button {
      background-color: #ff6b6b;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 10px;
    }
    button:disabled {
      background-color: gray;
    }
    input {
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      width: 80%;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="card" id="app">
    <h2 id="greeting">Welcome!</h2>
    <p id="points">Points: 0</p>
    <button onclick="startTasks()">Start Tasks</button>
    <div id="taskArea" style="margin-top:20px;"></div>
    <div id="withdrawArea" style="margin-top:20px; display: none;">
      <button onclick="showWithdrawForm()">Withdraw $0.02</button>
    </div>
    <div id="paypalForm" style="display: none;">
      <input type="email" id="paypalEmail" placeholder="Enter PayPal Email">
      <button onclick="submitWithdraw()">Submit</button>
    </div>
  </div>  <script>
    let user = {
      id: '',
      name: 'User',
      points: 0
    };

    // Telegram WebApp init
    window.Telegram.WebApp.ready();
    const tg = window.Telegram.WebApp;
    if (tg.initDataUnsafe?.user) {
      user.id = tg.initDataUnsafe.user.id;
      user.name = tg.initDataUnsafe.user.first_name;
      document.getElementById('greeting').textContent = `Hi, ${user.name}!`;
    }

    const taskArea = document.getElementById('taskArea');
    const pointsEl = document.getElementById('points');
    let taskIndex = 0;

    const tasks = [
      () => `Click the button 5 times fast: <button onclick="taskClicks()">Tap me!</button><span id='clickCount'>0</span>`,
      () => `Match the emoji: <span>ðŸ™‚</span><br><button onclick="emojiMatch('ðŸ™‚')">ðŸ™‚</button><button onclick="emojiMatch('ðŸ˜Ž')">ðŸ˜Ž</button>`,
      () => `Click as soon as you see "NOW!": <br><button id="reactBtn" disabled>Wait...</button>`,
      () => `Guess a number (1-5): <input type="number" id="guess" min="1" max="5"><button onclick="guessNumber()">Guess</button>`,
      () => `Memorize and repeat: <br>Code: <b id="code">234</b><br><input type="text" id="memoryInput"><button onclick="checkMemory()">Submit</button>`
    ];

    function startTasks() {
      taskIndex = 0;
      nextTask();
    }

    function nextTask() {
      if (taskIndex >= tasks.length) {
        taskIndex = 0;
      }
      taskArea.innerHTML = tasks[taskIndex++]();

      if (taskIndex === 3) {
        // For reaction test
        const btn = document.getElementById('reactBtn');
        setTimeout(() => {
          btn.textContent = 'NOW!';
          btn.disabled = false;
          btn.onclick = () => {
            addPoints();
            nextTask();
          };
        }, Math.random() * 2000 + 1000);
      }

      if (taskIndex === 5) {
        document.getElementById('code').textContent = '234'; // static code
      }
    }

    let clicks = 0;
    function taskClicks() {
      clicks++;
      document.getElementById('clickCount').textContent = clicks;
      if (clicks >= 5) {
        clicks = 0;
        addPoints();
        nextTask();
      }
    }

    function emojiMatch(choice) {
      if (choice === 'ðŸ™‚') {
        addPoints();
        nextTask();
      } else {
        alert('Try again!');
      }
    }

    function guessNumber() {
      const userGuess = parseInt(document.getElementById('guess').value);
      const number = Math.floor(Math.random() * 5) + 1;
      if (userGuess === number) {
        addPoints();
      } else {
        alert(`Wrong! It was ${number}`);
      }
      nextTask();
    }

    function checkMemory() {
      const val = document.getElementById('memoryInput').value;
      if (val === '234') {
        addPoints();
      } else {
        alert('Wrong code!');
      }
      nextTask();
    }

    function addPoints() {
      user.points += 10;
      pointsEl.textContent = `Points: ${user.points}`;
      if (user.points >= 200) {
        document.getElementById('withdrawArea').style.display = 'block';
      }
    }

    function showWithdrawForm() {
      document.getElementById('paypalForm').style.display = 'block';
    }

    function submitWithdraw() {
      const email = document.getElementById('paypalEmail').value;
      if (!validateEmail(email)) {
        alert('Enter a valid email');
        return;
      }
      const payload = {
        id: user.id,
        name: user.name,
        score: user.points,
        paypal: email
      };
      // Example: Save to GitHub Gist or backend
      console.log('Sending to GitHub backend:', payload);
      alert('Submitted! We will send $0.02 to your PayPal soon.');
    }

    function validateEmail(email) {
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }
  </script></body>
</html>
